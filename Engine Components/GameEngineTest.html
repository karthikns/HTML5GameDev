<!DOCTYPE html>
<html>
	<head>
		<title> Game Engine Test </title>
		<script src="RenderEngine.js"> </script>
		<script src="physicsEngine.js"> </script>
		<script src="InputEngine.js"> </script>
		<script src="GameEngine.js"> </script>
        <script src="Box2dWeb-2.1.a.3.js"></script>

		<script>
		<!--
		function setup()
		{
			gGameEngine.initialize("configuration/renderConfig.json", init);

			var canvasElement = document.getElementById("my_canvas");
			gGameEngine.setCanvas(canvasElement);
		}

        function render()
        {
            renderPool.render();
            setTimeout(render, 1000/60); //60FPS
        }

        function EnemyPool()
        {
        }

        EnemyPool.prototype.pool = null;

        EnemyPool.prototype.initialize = function(numRow, numCol)
        {
			var percentFire = 0.005;

        	this.pool = new Array();

        	for(var row = 0; row < numRow; ++row)
        	{
	        	for(var col = 0; col < numCol; ++col)
	        	{
	        		var x = 70 + col * 60;
	        		var y = 30 + row * 50;

					var enemyShip = new Ship();
					enemyShip.setPosition(x, y);
					enemyShip.setWidthHeight(42, 32);
					enemyShip.setImage("eship");
                    enemyShip.setCategoryBits(4);
                    enemyShip.setMaskBits(15);

		            var gun = new Gun();
		            gun.setPosition(0, 5);
		            gun.setBulletImage("b2");
		            gun.setBulletWidthHeight(2, 14);
		            gun.setBulletVelocity(0, 10);
                    gun.setBulletType("enemy");

		            enemyShip.addGun(gun);

		            enemyShip.initialize();

		            var intervalID = setInterval(enemyFire, 1000/60, enemyShip, percentFire);
		            enemyShip.setKeyValue("intervalID", intervalID);

		            this.pool[this.pool.length] = enemyShip;
	        	}
        	}
        }

        function enemyFire(obj, percentFire)
        {
			if (Math.random() < percentFire)
			{
				obj.fire();
			}
        }

		function init()
		{
			var scrollRend = new ImageRendererScroll("bg", 32, 0);
			scrollRend.x = 120;
			scrollRend.y = 10;
			renderPool.addObject(scrollRend);
			scrollRend.startScroll();

			var enemyPool = new EnemyPool();
			enemyPool.initialize(2, 5);

            for(var i=0; i<enemyPool.pool.length; i++ )
            {
                enemyPool.pool[i].moveLeft();
            }

            var playerShip = new PlayerShip();

            playerShip.setPosition(250, 250);
            playerShip.setWidthHeight(64,52);

            playerShip.setImage("ship");

            playerShip.setCategoryBits(2);
            playerShip.setMaskBits(23);

            playerShip.setMoveVelocity(10);

            playerShip.setLeftKey(37);
            playerShip.setUpKey(38);
            playerShip.setRightKey(39);
            playerShip.setDownKey(40);
            playerShip.setFireKey(32); // Space

            playerShip.setFireRate(6);

            var gun = new Gun();
            gun.setPosition(10, -5);
            gun.setBulletImage("b1");
            gun.setBulletWidthHeight(2, 14);
            gun.setBulletVelocity(0, -10);

            playerShip.addGun(gun);

			gun = new Gun();
            gun.setPosition(-10, -5);
            gun.setBulletImage("b1");
            gun.setBulletWidthHeight(2, 14);
            gun.setBulletVelocity(0, -10);
            gun.setBulletType("player");

            playerShip.addGun(gun);

            playerShip.initialize();

            createBoundary();

			gGameEngine.beginGame();
		}

        function createBoundary()
        {
            var leftWall = new Wall();
            leftWall.setPosition(0,0);
            leftWall.setWidthHeight(1,600);
            leftWall.setCategoryBits(1);
            leftWall.setMaskBits(30);
            leftWall.initialize();

            var rightWall = new Wall();
            rightWall.setPosition(500,0);
            rightWall.setWidthHeight(1,600);
            rightWall.setCategoryBits(1);
            rightWall.setMaskBits(30);
            rightWall.initialize();

            var topWall = new Wall();
            topWall.setPosition(0,-20);
            topWall.setWidthHeight(1000,1);
            topWall.setCategoryBits(1);
            topWall.setMaskBits(30);
            topWall.initialize();

            var bottomWall = new Wall();
            bottomWall.setPosition(0,320);
            bottomWall.setWidthHeight(1000,1);
            bottomWall.setCategoryBits(1);
            bottomWall.setMaskBits(30);
            bottomWall.initialize();
        }

		-->
		</script>
	</head>
	<body onload="setup()">
		<canvas id="my_canvas" width="500" height="300" style="border:1px solid #FF0000;"> </canvas>

        <canvas id="physics_canvas" width="500" height="300" style="border:1px solid #FF0000;"> </canvas>
	</body>
</html>